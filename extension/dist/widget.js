import{r as f,j as e,c as O}from"./assets/client.js";const p="widgetNotes";function C(d){const c=[];return d.forEach((i,o)=>{c.push({...i,isBreak:!1}),o<d.length-1&&c.push({id:`${i.id}-break-${o}`,title:"Recharge break",estimatedMinutes:5,order:i.order+.5,isBreak:!0})}),c}function A(d){const c=C(d);if(!c.length)return[];const i=[];let o=Date.now();return c.forEach(g=>{const l=g.estimatedMinutes*6e4;i.push({id:g.id,title:g.isBreak?`${g.title} (5 min)`:g.title,startTime:o,endTime:o+l,isBreak:g.isBreak,durationMinutes:g.estimatedMinutes}),o+=l}),i}function D(d){const c=Math.floor(d/60),i=d%60;return c>0?`${c}h ${i}m`:`${i}m`}const P=()=>{const[d,c]=f.useState(!1),[i,o]=f.useState(null),[g,l]=f.useState([]),[m,h]=f.useState(""),[M,w]=f.useState(!1),[z,b]=f.useState(!1),[k,B]=f.useState(Date.now()),S=f.useRef();f.useEffect(()=>{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local){chrome.storage.local.get(["sfState",p],t=>{const r=t.sfState;r?.activeSession?(o(r.activeSession),l(r.activeSession.baseTasks??[])):t.activeSession&&(o(t.activeSession),l(t.activeSession.baseTasks??[])),typeof t[p]=="string"&&h(t[p])});const a=(t,r)=>{if(r==="local"){if(t.sfState?.newValue?.activeSession){const n=t.sfState.newValue.activeSession;o(n),n?.baseTasks?l(n.baseTasks):l([])}else if(t.activeSession){const n=t.activeSession.newValue;o(n),n?.baseTasks?l(n.baseTasks):l([])}if(Object.prototype.hasOwnProperty.call(t,p)){const n=t[p].newValue;typeof n=="string"&&h(n)}}};return chrome.storage.onChanged.addListener(a),()=>chrome.storage.onChanged.removeListener(a)}try{const a=localStorage.getItem("sfState");if(a){const r=JSON.parse(a),n=r.sfState??r;n?.activeSession?(o(n.activeSession),l(n.activeSession.baseTasks??[])):n?.activeSession===void 0&&r.activeSession&&(o(r.activeSession),l(r.activeSession.baseTasks??[]))}const t=localStorage.getItem(p);t&&h(t)}catch{}},[]),f.useEffect(()=>{const s=window.setInterval(()=>B(Date.now()),1e3);return()=>window.clearInterval(s)},[]),f.useEffect(()=>(window.clearTimeout(S.current),S.current=window.setTimeout(()=>{if(typeof chrome<"u"&&chrome.storage&&chrome.storage.local)chrome.storage.local.set({[p]:m});else try{localStorage.setItem(p,m)}catch{}},400),()=>window.clearTimeout(S.current)),[m]);const u=f.useMemo(()=>{if(!i)return null;const s=i.entries[i.currentIndex];if(!s)return null;const a=s.estimatedMinutes*6e4,t=k-i.phaseStartedAt,r=Math.max(0,a-t),n=Math.floor(r/6e4),v=Math.floor(r%6e4/1e3),R=Math.max(a,1);return{title:s.title,isBreak:!!s.isBreak,formatted:`${n}:${v.toString().padStart(2,"0")}`,progress:Math.min(100,(a-r)/R*100),remaining:r}},[i,k]),I=f.useCallback(s=>{if(!i)return;w(!0);const a={baseTasks:s,entries:C(s),blockedSites:i.blockedSites??[],timetable:A(s)};if(typeof chrome<"u"&&chrome.runtime&&chrome.runtime.sendMessage)chrome.runtime.sendMessage({type:"SF_UPDATE_SESSION",payload:a},t=>{if(w(!1),b(!1),chrome.runtime.lastError){console.error(chrome.runtime.lastError.message);return}if(t?.error){console.error(t.error);return}t?.session&&(o(t.session),l(t.session.baseTasks??[]))});else{try{const t={activeSession:{baseTasks:a.baseTasks,entries:a.entries,blockedSites:a.blockedSites,currentIndex:i.currentIndex,phaseStartedAt:i.phaseStartedAt,sessionStartedAt:i.sessionStartedAt,timetable:a.timetable}};localStorage.setItem("sfState",JSON.stringify(t))}catch{}w(!1),b(!1)}},[i]),j=(s,a,t)=>{l(r=>r.map(n=>{if(n.id!==s)return n;if(a==="title")return{...n,title:t};const v=Math.max(1,Number(t)||1);return{...n,estimatedMinutes:v}})),b(!0)},N=()=>{z&&I(g)},$=e.jsxs("button",{type:"button",className:"sf-widget-toggle","aria-label":"Open Procastus widget",onClick:()=>c(!0),children:[e.jsx("span",{children:"Procastus"}),i&&u&&e.jsx("strong",{children:u.formatted})]}),y=i?.entries.slice((i?.currentIndex??-1)+1)??[],x=!!i;return e.jsxs("div",{className:`sf-widget-container ${x?"":"sf-widget-container--inactive"}`,children:[!d&&$,d&&e.jsxs("div",{className:"sf-widget-panel",children:[e.jsxs("div",{className:"sf-widget-panel-header",children:[e.jsxs("div",{children:[e.jsx("p",{className:"sf-widget-subtitle",children:"Focus assistant"}),e.jsx("h3",{children:x?"Current plan":"Ready when you are"})]}),e.jsx("div",{className:"sf-widget-actions",children:e.jsx("button",{type:"button",className:"sf-widget-chip",onClick:()=>c(!1),children:"Collapse"})})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"sf-widget-empty",children:"Start a focus session from the Procastus popup to unlock the in-page planner."}),e.jsxs("section",{children:[e.jsxs("div",{className:"sf-widget-section-header",children:[e.jsx("h4",{children:"Notes"}),e.jsx("span",{children:"Jot thoughts anytime"})]}),e.jsx("textarea",{className:"sf-widget-notes",rows:4,value:m,placeholder:"Capture ideas while you browse…",onChange:s=>h(s.target.value)})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`sf-widget-timer ${u?.isBreak?"sf-widget-timer--break":""}`,children:[e.jsxs("div",{className:"sf-widget-timer-meta",children:[e.jsx("span",{children:u?.isBreak?"Break":"Time remaining"}),M&&e.jsx("span",{className:"sf-widget-status",children:"Saving…"})]}),e.jsx("div",{className:"sf-widget-timer-value",children:u?.formatted??"--:--"}),e.jsx("div",{className:"sf-widget-timer-bar",children:e.jsx("div",{style:{width:`${u?.progress??0}%`}})})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"sf-widget-section-header",children:[e.jsx("h4",{children:"Schedule"}),e.jsxs("span",{children:[i?.baseTasks.length??0," tasks"]})]}),e.jsx("div",{className:"sf-widget-task-list",children:g.map((s,a)=>e.jsxs("div",{className:"sf-widget-task-row",children:[e.jsx("span",{className:"sf-widget-task-number",children:a+1}),e.jsx("input",{className:"sf-widget-inline-input",value:s.title,onChange:t=>j(s.id,"title",t.target.value),onBlur:N}),e.jsx("input",{className:"sf-widget-inline-input sf-widget-inline-number",type:"number",value:s.estimatedMinutes.toString(),onChange:t=>j(s.id,"estimatedMinutes",t.target.value),onBlur:N}),e.jsx("span",{className:"sf-widget-inline-suffix",children:"min"})]},s.id))})]}),y.length>0&&e.jsxs("section",{className:"sf-widget-upcoming",children:[e.jsx("div",{className:"sf-widget-section-header",children:e.jsx("h4",{children:"Up next"})}),e.jsx("div",{className:"sf-widget-upcoming-list",children:y.map(s=>e.jsx("div",{className:`sf-widget-upcoming-row ${s.isBreak?"sf-widget-upcoming-row--break":""}`,children:e.jsxs("div",{children:[e.jsx("strong",{children:s.title}),e.jsx("span",{children:s.isBreak?"5 min break":D(s.estimatedMinutes)})]})},s.id))})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"sf-widget-section-header",children:[e.jsx("h4",{children:"Notes"}),e.jsx("span",{children:"Stay organized"})]}),e.jsx("textarea",{className:"sf-widget-notes",rows:4,value:m,placeholder:"Capture quick thoughts, references, or reminders…",onChange:s=>h(s.target.value)})]})]})]})]})},F=".sf-widget-container{position:fixed;bottom:24px;right:24px;z-index:2147483647;font-family:Inter,Segoe UI,system-ui,-apple-system,BlinkMacSystemFont,sans-serif;color:#f8fafc}.sf-widget-container--inactive{opacity:.75}.sf-widget-toggle{border:none;border-radius:999px;padding:10px 18px;background:#2563ebe6;color:#f8fafc;font-weight:600;font-size:14px;display:flex;align-items:center;gap:10px;cursor:pointer;box-shadow:0 12px 35px #02061773}.sf-widget-panel{width:min(360px,calc(100vw - 32px));background:#050816f2;border:1px solid rgba(148,163,184,.25);border-radius:20px;padding:18px;box-shadow:0 25px 60px #020617a6}.sf-widget-panel-header{display:flex;justify-content:space-between;align-items:center}.sf-widget-subtitle{text-transform:uppercase;letter-spacing:.2em;font-size:10px;color:#818cf8;margin:0 0 6px}.sf-widget-panel-header h3{margin:0;font-size:20px;color:#f8fafc}.sf-widget-chip{border:1px solid rgba(148,163,184,.35);border-radius:999px;background:#0f172a80;color:#e2e8f0;padding:6px 12px;font-size:12px;cursor:pointer}.sf-widget-timer{margin-top:16px;padding:16px;border-radius:14px;background:linear-gradient(135deg,#2563eb59,#0ea5e933);border:1px solid rgba(14,165,233,.4)}.sf-widget-timer--break{background:linear-gradient(135deg,#fbbf2459,#fb923c33);border-color:#fbbf2466}.sf-widget-timer-meta{display:flex;justify-content:space-between;color:#cbd5f5;font-size:12px}.sf-widget-status{font-size:11px;color:#38bdf8}.sf-widget-timer-value{font-size:44px;font-weight:700;text-align:center;margin:8px 0;color:#f8fafc}.sf-widget-timer-bar{width:100%;height:6px;border-radius:999px;background:#0f172a66;overflow:hidden}.sf-widget-timer-bar div{height:100%;border-radius:inherit;background:linear-gradient(90deg,#38bdf8,#6366f1);transition:width .3s ease}.sf-widget-section-header{display:flex;justify-content:space-between;align-items:center;margin:20px 0 8px;font-size:13px;color:#94a3b8}.sf-widget-section-header h4{margin:0;color:#f8fafc;font-size:15px}.sf-widget-task-list{display:flex;flex-direction:column;gap:10px}.sf-widget-task-row{display:grid;grid-template-columns:28px 1fr 60px auto;gap:8px;padding:10px;border-radius:12px;background:#080c1ed9;border:1px solid rgba(148,163,184,.2);align-items:center}.sf-widget-task-number{width:28px;height:28px;border-radius:50%;background:#4338ca59;color:#cbd5f5;font-size:12px;display:flex;align-items:center;justify-content:center;font-weight:600}.sf-widget-inline-input{border:none;background:transparent;color:#f8fafc;font-size:13px;padding:4px 0;outline:none}.sf-widget-inline-input::placeholder{color:#64748b}.sf-widget-inline-number{text-align:right;width:100%}.sf-widget-inline-number::-webkit-outer-spin-button,.sf-widget-inline-number::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.sf-widget-inline-suffix{font-size:12px;color:#94a3b8}.sf-widget-upcoming{margin-top:8px}.sf-widget-upcoming-list{display:flex;flex-direction:column;gap:8px}.sf-widget-upcoming-row{padding:10px 12px;border-radius:10px;background:#080c1ecc;border:1px solid rgba(56,189,248,.25)}.sf-widget-upcoming-row--break{border-color:#fbbf2466}.sf-widget-upcoming-row strong{display:block;color:#f8fafc;font-size:13px}.sf-widget-upcoming-row span{font-size:12px;color:#94a3b8}.sf-widget-notes{width:100%;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:#080c1ed9;color:#f8fafc;padding:12px;font-size:13px;resize:vertical;min-height:110px}.sf-widget-notes::placeholder{color:#64748b}.sf-widget-empty{margin:12px 0 0;font-size:13px;color:#94a3b8}",E="sf-widget-root";let T=null;function U(){if(document.getElementById(E))return;const d=document.createElement("div");d.id=E,document.documentElement.appendChild(d);const c=d.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=F,c.appendChild(i);const o=document.createElement("div");c.appendChild(o),T=O.createRoot(o),T.render(e.jsx(P,{}))}U();
